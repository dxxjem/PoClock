"use strict";var p=Object.create;var w=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,R=Object.prototype.hasOwnProperty;var b=(e,n,s,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let c of _(n))!R.call(e,c)&&c!==s&&w(e,c,{get:()=>n[c],enumerable:!(i=m(n,c))||i.enumerable});return e};var E=(e,n,s)=>(s=e!=null?p(g(e)):{},b(n||!e||!e.__esModule?w(s,"default",{value:e,enumerable:!0}):s,e));Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const o=require("electron"),I=require("node:url"),T=require("node:path");var a=typeof document<"u"?document.currentScript:null;function h(e){const n=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const s in e)if(s!=="default"){const i=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>e[s]})}}return n.default=e,Object.freeze(n)}const t=h(T);o.ipcMain.handle("set-progress-bar",(e,n)=>{const s=o.BrowserWindow.getAllWindows()[0];s&&s.setProgressBar(n)});o.ipcMain.handle("set-taskbar-icon",async(e,n)=>{console.log("接收到设置任务栏图标请求:",n);const s=o.BrowserWindow.getAllWindows()[0];if(s)try{let i=n;return t.isAbsolute(n)||(i=t.join(process.env.VITE_PUBLIC||d,n)),console.log("图标完整路径:",i),(await import("node:fs")).existsSync(i)?(s.setIcon(i),console.log("任务栏图标设置成功"),{success:!0}):(console.error("图标文件不存在:",i),{success:!1,error:"图标文件不存在"})}catch(i){return console.error("设置任务栏图标失败:",i),{success:!1,error:i.message||"未知错误"}}else return console.log("未找到窗口"),{success:!1,error:"未找到窗口"}});o.ipcMain.handle("minimize-window",()=>{const e=o.BrowserWindow.getAllWindows()[0];e&&e.minimize()});o.ipcMain.handle("maximize-window",()=>{const e=o.BrowserWindow.getAllWindows()[0];e&&(e.isMaximized()?e.unmaximize():e.maximize())});o.ipcMain.handle("close-window",()=>{const e=o.BrowserWindow.getAllWindows()[0];e&&e.close()});const d=t.dirname(I.fileURLToPath(typeof document>"u"?require("url").pathToFileURL(__filename).href:a&&a.tagName.toUpperCase()==="SCRIPT"&&a.src||new URL("main.js",document.baseURI).href));process.env.APP_ROOT=t.join(d,"..");const l=process.env.VITE_DEV_SERVER_URL,S=t.join(process.env.APP_ROOT,"dist-electron"),u=t.join(process.env.APP_ROOT,"dist");process.env.VITE_PUBLIC=l?t.join(process.env.APP_ROOT,"public"):u;let r;function f(){const e=!!l;r=new o.BrowserWindow({width:800,height:600,title:"番茄时钟",icon:t.join(process.env.VITE_PUBLIC,"work.ico"),skipTaskbar:!1,frame:!1,webPreferences:{preload:t.join(d,"preload.js"),contextIsolation:!0,nodeIntegration:!1,sandbox:!1,webSecurity:!0,allowRunningInsecureContent:!1,...e&&{webSecurity:!1}}}),r.webContents.on("did-finish-load",()=>{r==null||r.webContents.send("main-process-message",new Date().toLocaleString())}),l?r.loadURL(l):r.loadFile(t.join(u,"index.html"))}o.app.on("window-all-closed",()=>{process.platform!=="darwin"&&(o.app.quit(),r=null)});o.app.on("activate",()=>{o.BrowserWindow.getAllWindows().length===0&&f()});o.ipcMain.on("notification",(e,n)=>{new o.Notification({title:"番茄时钟",body:n}).show()});o.app.whenReady().then(f);exports.MAIN_DIST=S;exports.RENDERER_DIST=u;exports.VITE_DEV_SERVER_URL=l;
